{% macro render_inline_header_field(form, field) %}
  <th>
    {{ field.label.text }}
    {% if h.is_required_form_field(field) %}
      <strong style="color: red">&#42;</strong>
    {%- else -%}
      &nbsp;
    {%- endif %}
  </th>
{% endmacro %}

{% macro render_inline_table_header(template) %}
  {# Checkbox #}
  <tr>
    <th class="delete-operation">删除?</th>
    {# Line number #}
    <th class="line-number">行号</th>
    {% for f in template.form if f.widget.input_type != 'hidden' %}
      {{ render_inline_header_field(form, f) }}
    {% endfor %}
  </tr>
{% endmacro %}

{% macro render_inline_fields(field, template, render, check=None) %}
  {# 隐藏模板 #}
  <div class="inline-field-template-{{ field.id }} hide">
    {% filter forceescape %}
      <tr class="inline-field">
        {# 删除操作 #}
        <td class="delete-operation">
          {# 移除图标 #}
          <a href="javascript:void(0)" class="inline-remove-field"><span class="fa fa-times glyphicon glyphicon-remove"></span></a>
        </td>
        <td class="line-number">
          <small>-</small>
        </td>
        {{ render(template) }}
      </tr>
    {% endfilter %}
  </div>
  <table class="table table-striped table-hover inline-field table-responsive table-bordered" id="{{ field.id }}">
    {# 渲染 inline 表头 #}
    {{ render_inline_table_header(template) }}
    {# existing inline form fields #}
    {% for subfield in field %}
      <tr class="inline-field" id="lines-{{ field.id }}">
        {# 删除操作 #}
        <td class="delete-operation">
          {%- if not check or check(subfield) %}
            {% if subfield.get_pk and subfield.get_pk() %}
              {# 如果有pk则设置勾选框 #}
              <input type="checkbox" name="del-{{ subfield.id }}" id="del-{{ subfield.id }}"/>
            {% else %}
              {# 没有pk则设置移除图标 #}
              <a href="javascript:void(0)" class="inline-remove-field"><i class="fa fa-times glyphicon glyphicon-remove"></i></a>
            {% endif %}
          {%- endif -%}
        </td>
        {# 行号 #}
        <td class="line-number">{{ loop.index }}</td>
        {# 其他字段 #}
        {{ render(subfield) }}
      </tr>
    {% endfor %}
    {# template for new inline form fields #}
  </table>
  {# 增加明细行 #}
  <div class="pull-right full-width">
    <a id="{{ field.id }}-button" href="javascript:void(0)" class="btn btn-default full-width btn-lg"
       onclick="addInlineField('{{ field.id }}');">{{ _gettext('Add') }}{{ field.label.text }}</a>
  </div>
{% endmacro %}
